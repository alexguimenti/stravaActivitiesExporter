var activities=[];var totalActivites=document.querySelector("body > div.page.container > form > div.h3.results-summary > div").textContent.replace('.','').split(' ')[0];var totalPages=Math.floor(totalActivites/20+1);var done=0;function removeAccentsFromLetters(text){return text.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/([^\w\s\/:.-])/gi,'');}function convertToCSV(arr){if(arr.length===0)return'';const headers=Object.keys(arr[0]);const headerLine=headers.join(',');const values=arr.map(activity=>{return headers.map(header=>{let value=activity[header]||'';value=value.toString().replace(',','.');return removeAccentsFromLetters(value);}).join(',');}).join('\n');return headerLine+'\n'+values;}function fetchActivities(totalPages){const requests=[];for(let page=1;page<=totalPages;page++){requests.push(jQuery.ajax({url:`https://www.strava.com/athlete/training_activities?page=${page}&per_page=20`,dataType:"json",method:"get",headers:{"Content-Type":"application/json; charset=utf-8"}}).done(data=>{data.models.forEach(activity=>{activities.push(activity);});done++;if(done%10===0||done===totalPages){console.log(Math.round(done*100/totalPages)+'%');}}).fail((jqXHR,textStatus,errorThrown)=>{console.error(`Error on page ${page}: ${textStatus}, ${errorThrown}`);}));}return jQuery.when.apply(jQuery,requests);}fetchActivities(totalPages).done(()=>{console.log('\nDONE!!!');console.log("\nIf download didn't start, check browser window to enable permission");if(activities.length>0){let csv=convertToCSV(activities);var hiddenElement=document.createElement('a');hiddenElement.href='data:text/csv;charset=utf-8,'+encodeURI(csv);hiddenElement.target='_blank';hiddenElement.download='activities.csv';hiddenElement.click();}}).fail(error=>{console.error('Error fetching activities:',error);});

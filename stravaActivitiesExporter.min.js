var activities=[],totalActivites=document.querySelector("body > div.page.container > form > div.h3.results-summary > div").textContent.replace(".","").split(" ")[0],totalPages=Math.floor(totalActivites/20+1),done=0;function removeAccentsFromLetters(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/([^\w\s\/:.-])/gi,"")}function convertToCSV(e){if(0===e.length)return"";let t=Object.keys(e[0]),r=t.join(","),i=e.map(e=>t.map(t=>{let r=e[t]||"";return removeAccentsFromLetters(r=r.toString().replace(",","."))}).join(",")).join("\n");return r+"\n"+i}function fetchActivities(e){let t=[];for(let r=1;r<=e;r++)t.push(jQuery.ajax({url:`https://www.strava.com/athlete/training_activities?page=${r}&per_page=20`,dataType:"json",method:"get",headers:{"Content-Type":"application/json; charset=utf-8"}}).done(t=>{t.models.forEach(e=>{activities.push(e)}),(++done%10==0||done===e)&&console.log(Math.round(100*done/e)+"%")}).fail((e,t,i)=>{console.error(`Error on page ${r}: ${t}, ${i}`)}));return jQuery.when.apply(jQuery,t)}fetchActivities(totalPages).done(()=>{if(console.log("\nDONE!!!"),console.log("\nIf download didn't start, check browser window to enable permission"),activities.length>0){let e=convertToCSV(activities);var t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURI(e),t.target="_blank",t.download="activities.csv",t.click()}}).fail(e=>{console.error("Error fetching activities:",e)});
